{% extends "base.html" %}

{% block title %}Analytics - My Diary{% endblock %}

{% block extra_css %}
<style>
.analytics-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

.analytics-header {
    background: linear-gradient(135deg, var(--bs-primary), var(--bs-secondary));
    color: white;
    padding: 2rem;
    border-radius: 20px;
    margin-bottom: 30px;
    text-align: center;
    position: relative;
    overflow: hidden;
}

.analytics-header::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 200%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
    animation: shimmer 3s infinite;
}

@keyframes shimmer {
    0% { left: -100%; }
    100% { left: 100%; }
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.stat-card {
    background: var(--bs-card-bg);
    border: 1px solid var(--bs-border-color);
    border-radius: 15px;
    padding: 25px;
    text-align: center;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.stat-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(0,0,0,0.15);
}

.stat-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, var(--bs-primary), var(--bs-secondary));
}

.stat-icon {
    font-size: 2.5rem;
    margin-bottom: 15px;
    color: var(--bs-primary);
}

.stat-value {
    font-size: 2.5rem;
    font-weight: 700;
    color: var(--bs-heading-color);
    margin-bottom: 5px;
}

.stat-label {
    color: var(--bs-secondary);
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.chart-container {
    background: var(--bs-card-bg);
    border: 1px solid var(--bs-border-color);
    border-radius: 15px;
    padding: 25px;
    margin-bottom: 30px;
}

.chart-title {
    font-size: 1.3rem;
    font-weight: 600;
    color: var(--bs-heading-color);
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.mood-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
    margin-top: 20px;
}

.mood-item {
    text-align: center;
    padding: 15px;
    border-radius: 10px;
    background: var(--bs-light);
    transition: all 0.3s ease;
}

.mood-item:hover {
    transform: scale(1.05);
}

.mood-emoji {
    font-size: 2rem;
    margin-bottom: 10px;
}

.mood-name {
    font-weight: 600;
    margin-bottom: 5px;
}

.mood-count {
    color: var(--bs-secondary);
    font-size: 0.9rem;
}

.tag-cloud {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 20px;
}

.tag-item {
    background: var(--bs-primary);
    color: white;
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 0.9rem;
    font-weight: 500;
    text-decoration: none;
    transition: all 0.3s ease;
}

.tag-item:hover {
    background: var(--bs-primary-hover, var(--bs-primary));
    transform: translateY(-2px);
    color: white;
}

.recent-activity {
    margin-top: 20px;
}

.activity-item {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 15px;
    border-radius: 10px;
    background: var(--bs-light);
    margin-bottom: 10px;
    transition: all 0.3s ease;
}

.activity-item:hover {
    background: var(--bs-light-hover, var(--bs-light));
}

.activity-icon {
    font-size: 1.5rem;
    color: var(--bs-primary);
}

.activity-details {
    flex: 1;
}

.activity-title {
    font-weight: 600;
    margin-bottom: 5px;
}

.activity-time {
    color: var(--bs-secondary);
    font-size: 0.85rem;
}

.bar-chart {
    display: flex;
    align-items: flex-end;
    gap: 10px;
    height: 200px;
    margin-top: 20px;
}

.bar-item {
    flex: 1;
    background: var(--bs-primary);
    border-radius: 5px 5px 0 0;
    position: relative;
    transition: all 0.3s ease;
    cursor: pointer;
}

.bar-item:hover {
    background: var(--bs-primary-hover, var(--bs-primary));
    transform: translateY(-5px);
}

.bar-label {
    position: absolute;
    bottom: -25px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 0.8rem;
    white-space: nowrap;
}

.bar-value {
    position: absolute;
    top: -25px;
    left: 50%;
    transform: translateX(-50%);
    font-weight: 600;
    font-size: 0.9rem;
}

.progress-ring {
    width: 120px;
    height: 120px;
    margin: 0 auto 20px;
}

.progress-ring-circle {
    transition: stroke-dashoffset 0.35s;
    transform: rotate(-90deg);
    transform-origin: 50% 50%;
}

@media (max-width: 768px) {
    .analytics-container {
        padding: 15px;
    }
    
    .stats-grid {
        grid-template-columns: 1fr;
        gap: 15px;
    }
    
    .stat-card {
        padding: 20px;
    }
    
    .mood-grid {
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    }
    
    .bar-chart {
        height: 150px;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="analytics-container">
    <div class="analytics-header">
        <h1>
            <i class="bi bi-graph-up me-3"></i>
            Your Writing Analytics
        </h1>
        <p class="mb-0">Track your journaling journey and discover insights</p>
    </div>
    
    <!-- Stats Grid -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon">
                <i class="bi bi-journal-text"></i>
            </div>
            <div class="stat-value">{{ total_entries }}</div>
            <div class="stat-label">Total Entries</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">
                <i class="bi bi-fonts"></i>
            </div>
            <div class="stat-value">{{ "{:,}".format(total_words) }}</div>
            <div class="stat-label">Total Words</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">
                <i class="bi bi-calculator"></i>
            </div>
            <div class="stat-value">{{ avg_words_per_entry }}</div>
            <div class="stat-label">Avg Words/Entry</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">
                <i class="bi bi-calendar-month"></i>
            </div>
            <div class="stat-value">{{ this_month_entries }}</div>
            <div class="stat-label">This Month</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">
                <i class="bi bi-fire"></i>
            </div>
            <div class="stat-value">{{ current_streak }}</div>
            <div class="stat-label">Current Streak</div>
        </div>
    </div>
    
    <!-- Monthly Progress Chart -->
    <div class="chart-container">
        <h3 class="chart-title">
            <i class="bi bi-bar-chart"></i>
            Monthly Writing Progress
        </h3>
        <div class="bar-chart">
            {% for data in monthly_data %}
            <div class="bar-item" style="height: {{ (data.count / max([item.count for item in monthly_data] + [1]) * 100) if monthly_data else 0 }}%">
                <div class="bar-value">{{ data.count }}</div>
                <div class="bar-label">{{ data.month }}</div>
            </div>
            {% endfor %}
        </div>
    </div>
    
    <div class="row">
        <!-- Mood Analysis -->
        <div class="col-lg-6">
            <div class="chart-container">
                <h3 class="chart-title">
                    <i class="bi bi-emoji-smile"></i>
                    Mood Distribution
                </h3>
                {% if mood_data %}
                <div class="mood-grid">
                    {% for mood, count in mood_data %}
                    <div class="mood-item">
                        <div class="mood-emoji">
                            {% if mood == 'happy' %}üòä{% elif mood == 'sad' %}üò¢{% elif mood == 'anxious' %}üò∞{% elif mood == 'excited' %}ü§ó{% elif mood == 'calm' %}üòå{% elif mood == 'angry' %}üò†{% else %}üòê{% endif %}
                        </div>
                        <div class="mood-name">{{ mood.title() }}</div>
                        <div class="mood-count">{{ count }} entries</div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-muted">No mood data available. Start tracking your moods in your entries!</p>
                {% endif %}
            </div>
        </div>
        
        <!-- Top Tags -->
        <div class="col-lg-6">
            <div class="chart-container">
                <h3 class="chart-title">
                    <i class="bi bi-tags"></i>
                    Most Used Tags
                </h3>
                {% if tag_data %}
                <div class="tag-cloud">
                    {% for tag, count in tag_data %}
                    <a href="{{ url_for('main.search_entries', tags=tag.name) }}" class="tag-item">
                        #{{ tag.name }} ({{ count }})
                    </a>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-muted">No tags used yet. Start organizing your entries with tags!</p>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- Recent Activity -->
    <div class="chart-container">
        <h3 class="chart-title">
            <i class="bi bi-clock-history"></i>
            Recent Activity
        </h3>
        <div class="recent-activity">
            {% if recent_entries %}
            {% for entry in recent_entries %}
            <div class="activity-item" onclick="window.location.href='{{ url_for('main.view_entry', id=entry.id) }}'">
                <div class="activity-icon">
                    <i class="bi bi-journal"></i>
                </div>
                <div class="activity-details">
                    <div class="activity-title">{{ entry.title or 'Untitled Entry' }}</div>
                    <div class="activity-time">{{ entry.created_at.strftime('%B %d, %Y at %I:%M %p') }}</div>
                </div>
            </div>
            {% endfor %}
            {% else %}
            <p class="text-muted text-center">No entries yet. Start writing to see your activity!</p>
            {% endif %}
        </div>
    </div>
    
    <!-- Writing Insights -->
    <div class="chart-container">
        <h3 class="chart-title">
            <i class="bi bi-lightbulb"></i>
            Writing Insights
        </h3>
        <div class="row">
            <div class="col-md-6">
                <h5>üìä Your Progress</h5>
                <ul class="list-unstyled">
                    <li><strong>{{ total_entries }}</strong> total entries written</li>
                    <li><strong>{{ "{:,}".format(total_words) }}</strong> words expressed</li>
                    <li><strong>{{ current_streak }}</strong> day current streak</li>
                    <li><strong>{{ avg_words_per_entry }}</strong> average words per entry</li>
                </ul>
            </div>
            <div class="col-md-6">
                <h5>üéØ Recommendations</h5>
                <ul class="list-unstyled">
                    {% if current_streak == 0 %}
                    <li>üìù Try to write daily to build a streak</li>
                    {% endif %}
                    {% if avg_words_per_entry < 50 %}
                    <li>üìñ Consider writing more detailed entries</li>
                    {% endif %}
                    {% if not mood_data %}
                    <li>üòä Start tracking your moods for insights</li>
                    {% endif %}
                    {% if not tag_data %}
                    <li>üè∑Ô∏è Use tags to organize your thoughts</li>
                    {% endif %}
                    <li>üéâ Keep up the great work!</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Add interactive animations
document.addEventListener('DOMContentLoaded', function() {
    // Animate stat cards on scroll
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.animation = 'fadeInUp 0.6s ease forwards';
            }
        });
    });
    
    document.querySelectorAll('.stat-card').forEach(card => {
        observer.observe(card);
    });
    
    // Animate bars
    const bars = document.querySelectorAll('.bar-item');
    bars.forEach((bar, index) => {
        setTimeout(() => {
            bar.style.animation = 'growBar 0.8s ease forwards';
        }, index * 100);
    });
});

// Add CSS animations
const style = document.createElement('style');
style.textContent = `
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    @keyframes growBar {
        from {
            height: 0;
        }
    }
`;
document.head.appendChild(style);
</script>
{% endblock %}
